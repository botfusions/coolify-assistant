<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¬</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind production uyarÄ±sÄ±nÄ± tamamen kapat
        if (typeof console !== 'undefined' && console.warn) {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && args[0].includes && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // Bu uyarÄ±yÄ± gÃ¶sterme
                }
                originalWarn.apply(console, args);
            };
        }
        
        tailwind.config = {
            theme: {
                extend: {}
            }
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Header -->
            <div class="bg-blue-500 text-white p-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-400 rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold">Chat Assistant</h1>
                        <p class="text-blue-100 text-sm">MesajÄ±nÄ±zÄ± yazÄ±n</p>
                    </div>
                </div>
            </div>

            <div x-data="simpleChat()" class="flex flex-col h-[600px]">
                <!-- Chat Messages Area -->
                <div class="flex-1 p-4 overflow-y-auto bg-gray-50" x-ref="messagesContainer">
                    <div x-show="messages.length === 0" class="text-center text-gray-500 mt-20">
                        <i class="fas fa-comment-dots text-4xl mb-4 text-blue-300"></i>
                        <h3 class="text-lg font-semibold mb-2">HoÅŸ Geldiniz!</h3>
                        <p>MesajÄ±nÄ±zÄ± yazÄ±n ve Enter'a basÄ±n.</p>
                    </div>
                    
                    <template x-for="(msg, index) in messages" :key="index">
                        <div class="mb-6">
                            <!-- User Message -->
                            <div class="flex justify-end mb-3">
                                <div class="bg-blue-500 text-white px-4 py-3 rounded-2xl rounded-tr-md max-w-[80%] shadow-sm">
                                    <p class="break-words whitespace-pre-wrap" x-text="msg.text"></p>
                                    <div class="text-xs text-blue-100 mt-2 opacity-75" x-text="msg.time"></div>
                                </div>
                            </div>
                            
                            <!-- Bot Response -->
                            <div x-show="msg.response" class="flex justify-start">
                                <div class="bg-white border border-gray-200 text-gray-800 px-4 py-3 rounded-2xl rounded-tl-md max-w-[80%] shadow-sm">
                                    <p class="break-words whitespace-pre-wrap" x-text="msg.response"></p>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Typing indicator -->
                    <div x-show="isTyping" class="flex justify-start mb-4">
                        <div class="bg-white border border-gray-200 text-gray-600 px-4 py-3 rounded-2xl rounded-tl-md shadow-sm">
                            <div class="flex items-center space-x-2">
                                <div class="flex space-x-1">
                                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                </div>
                                <span class="text-sm">YanÄ±t hazÄ±rlanÄ±yor...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="border-t border-gray-200 p-4 bg-white">
                    <div class="flex items-end space-x-3">
                        <div class="flex-1">
                            <textarea x-model="currentMessage" 
                                      x-ref="messageInput"
                                      @keydown="handleKeydown($event)"
                                      @input="autoResize"
                                      rows="1" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none placeholder-gray-500 text-gray-900"
                                      placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..."
                                      style="min-height: 48px; max-height: 120px;"></textarea>
                        </div>
                        
                        <!-- Send Button -->
                        <button @click="sendMessage()" 
                                :disabled="!currentMessage.trim() || isTyping"
                                :class="currentMessage.trim() && !isTyping ? 'bg-blue-500 hover:bg-blue-600 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
                                class="p-3 rounded-lg transition-colors shadow-sm">
                            <i x-show="!isTyping" class="fas fa-paper-plane text-lg"></i>
                            <i x-show="isTyping" class="fas fa-spinner animate-spin text-lg"></i>
                        </button>
                    </div>
                    
                    <div class="mt-2 text-xs text-gray-500 flex items-center justify-between">
                        <span>Enter ile gÃ¶nder, Shift+Enter ile yeni satÄ±r</span>
                        <span x-text="`${currentMessage.length} karakter`"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-4 text-gray-500">
            <p class="text-sm">
                <i class="fas fa-shield-alt mr-1"></i>
                MesajlarÄ±nÄ±z gÃ¼venli bir ÅŸekilde iÅŸlenir
            </p>
        </div>
    </div>

    <script>
        function simpleChat() {
            return {
                messages: [],
                currentMessage: '',
                isTyping: false,

                handleKeydown(event) {
                    if (event.key === 'Enter' && !event.shiftKey) {
                        event.preventDefault();
                        this.sendMessage();
                    }
                },

                autoResize() {
                    this.$nextTick(() => {
                        const textarea = this.$refs.messageInput;
                        if (textarea) {
                            textarea.style.height = 'auto';
                            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
                        }
                    });
                },

                scrollToBottom() {
                    this.$nextTick(() => {
                        const container = this.$refs.messagesContainer;
                        if (container) {
                            container.scrollTop = container.scrollHeight;
                        }
                    });
                },

                async sendMessage() {
                    if (!this.currentMessage.trim() || this.isTyping) return;

                    // Add user message to chat
                    const userMessage = {
                        text: this.currentMessage,
                        time: new Date().toLocaleTimeString('tr-TR', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        }),
                        response: null
                    };

                    this.messages.push(userMessage);
                    this.scrollToBottom();

                    // Store message and clear input
                    const messageText = this.currentMessage;
                    this.currentMessage = '';
                    
                    // Reset textarea height
                    const textarea = this.$refs.messageInput;
                    if (textarea) {
                        textarea.style.height = 'auto';
                    }

                    // Show typing indicator
                    this.isTyping = true;

                    try {
                        // Send to N8N webhook
                        const response = await fetch('https://n8n.botfusions.com/webhook/94de457f-7cd6-4478-9d6a-c232ae680ac6/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chatInput: messageText,
                                message: messageText,
                                timestamp: new Date().toISOString(),
                                user: 'web_user'
                            })
                        });

                        this.isTyping = false;

                        if (response.ok) {
                            const result = await response.text();
                            
                            // Try to parse JSON response, fallback to text
                            let botResponse = result;
                            try {
                                const jsonResult = JSON.parse(result);
                                botResponse = jsonResult.message || jsonResult.response || result;
                            } catch (e) {
                                // Use raw text response
                            }

                            // Add bot response to the message
                            userMessage.response = botResponse;
                        } else {
                            userMessage.response = `Hata: ${response.status} - ${response.statusText}`;
                        }

                    } catch (error) {
                        this.isTyping = false;
                        console.error('Chat error:', error);
                        userMessage.response = 'BaÄŸlantÄ± hatasÄ±: ' + error.message;
                    }

                    this.scrollToBottom();
                }
            }
        }
    </script>
</body>
</html>
